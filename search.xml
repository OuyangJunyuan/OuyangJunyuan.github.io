<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hexo + github pages 搭建个人博客</title>
    <url>/2021/12/12/Hexo-github-pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<p>​        快速上手<code>hexo博客框架</code>+<code>volantis主题</code>+<code>github pages部署</code>  搭建个人博客. </p>
<span id="more"></span>



<p>​        适合像我一样,虽然不知道搭个博客干啥(很酷?)(平常记录都贴知乎了),也不会前端那套技术栈的人快速搭一个满足一下自己的好奇心.</p>
<p>​        几小时内的建设<a href="https://ouyangjunyuan.github.io/">成果</a>(感谢大佬们搭的框架和写的文档). 虽然个人博客/主页搭建有很多文章了,但我还是把自己的过程记录和分享一下.</p>
<h1 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h1><ol>
<li><p>安装nodejs和npm</p>
<p>首先查看nodejs版本</p>
<p><code> nodejs -v</code> ,如果版本低于10需要升级.</p>
<p><code>curl -sL https://deb.nodesource.com/setup_12.x | bash - </code> 然后update一下</p>
<p><code> sudo apt-get install -y nodejs</code></p>
<p><code>sudo apt-get install npm</code></p>
</li>
<li><p>安装hexo(博客框架?)</p>
<p><code>npm install hexo</code>就安装好了</p>
<p>然后找一个目录作为个人博客的源码仓库.<code>mkdir ~/Blog</code></p>
<p><code>cd ~ &amp;&amp; hexo init Blog</code> 就开始下载一些依赖并构建博客仓库了.</p>
</li>
<li><p>部署</p>
<p>github上新建一个仓库, 仓库名为<code>用户名.io</code>如<a href="https://github.com/OuyangJunyuan/OuyangJunyuan.github.io">OuyangJunyuan.github.io</a> </p>
<p>回到博客仓库<code>~/Blog</code>, 修改其中<code>_config.yaml</code> 找到deploy, 填入github repo.</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span>  </span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:OuyangJunyuan/OuyangJunyuan.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>

<p>然后就可以了.</p>
</li>
</ol>
<p>hexo<a href="https://hexo.io/zh-cn/docs/">文档参考</a>,然后熟悉一下命令,在博客仓库内输入:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo clean # 清除生成结果</span><br><span class="line">hexo g # 生成页面</span><br><span class="line">hexo s # 部署到本地</span><br><span class="line">hexo d # 部署到远程</span><br></pre></td></tr></table></figure>

<p>此时可以试试<code>hexo g &amp;&amp; hexo s</code>, 访问链接就是生成的结果</p>
<p><img src="https://s2.loli.net/2021/12/12/W8gF7kzNil5EaL9.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/12/W8gF7kzNil5EaL9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211212191805604"></p>
<p><img src="https://s2.loli.net/2021/12/12/mI6ECAlsaMgKZ3U.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/12/mI6ECAlsaMgKZ3U.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211212191848764"></p>
<h1 id="主题配置"><a href="#主题配置" class="headerlink" title="主题配置"></a>主题配置</h1><p>下面开始介绍怎么弄出页面来.首先基于hexo框架的博客有许多开源主题,帮我搭好了框架.帮我们实现了如下的功能:</p>
<ul>
<li><strong>编写.md -&gt; 写博客</strong></li>
<li>修改.yml -&gt; 修改配置页面</li>
</ul>
<p>我们选择好看的<code>volantis</code>: 到博客仓库下的<code>_config.yml</code>中修改<code>theme: volantis</code>,然后<code>npm i hexo-theme-volantis</code> 安装主题. 安装完主题后重新</p>
<p><code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo s</code>,访问连接<a href="http://localhost:4000预览一下.好像变得好看了一点">http://localhost:4000预览一下.好像变得好看了一点</a>???</p>
<p><img src="https://s2.loli.net/2021/12/12/mpcJYGs3PxahONT.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/12/mpcJYGs3PxahONT.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211212192150601"></p>
<h1 id="博客编写"><a href="#博客编写" class="headerlink" title="博客编写"></a>博客编写</h1><p>只需要<code>hexo new &#39;my_first_blog&#39;</code> 就可以在<code>~/Blog/source/_post/</code>下生成一个markdown文档.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(dl) ➜  blog hexo new <span class="string">&#x27;my_first_blog&#x27;</span>           </span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO  </span><br><span class="line">============================================================</span><br><span class="line">  Volantis 5.0.0-rc.1</span><br><span class="line">  Docs: https://volantis.js.org/</span><br><span class="line">  Repo: https://github.com/volantis-x/hexo-theme-volantis/</span><br><span class="line">============================================================</span><br><span class="line">INFO  Created: ~/blog/<span class="built_in">source</span>/_posts/my-first-blog.md</span><br></pre></td></tr></table></figure>

<p><code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo s</code>,访问连接<a href="http://localhost:4000预览一下.就可以看到主页上多了一篇博客">http://localhost:4000预览一下.就可以看到主页上多了一篇博客</a>.</p>
<p><img src="https://s2.loli.net/2021/12/12/QSZOurz8PJcxbME.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/12/QSZOurz8PJcxbME.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211212192650314"></p>
<h1 id="个性化配置"><a href="#个性化配置" class="headerlink" title="个性化配置"></a>个性化配置</h1><p><code>~/Blog/_config.yml</code>中</p>
<h2 id="site"><a href="#site" class="headerlink" title="site"></a>site</h2><div class="story post-story"><p><img src="https://s2.loli.net/2021/12/12/ZnMg87Ue93LIhVw.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/12/ZnMg87Ue93LIhVw.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211212192952097"></p>
<p><code>title: Hexo  # 修改为自己的名字</code> , 这是网页的标题</p>
<p><code>favicon: https://s2.loli.net/2021/12/10/qpIiAZe9lFWT75H.png # 网页图标</code> </p>
</div><h2 id="主页封面"><a href="#主页封面" class="headerlink" title="主页封面"></a>主页封面</h2><div class="story post-story"><p>复制<code>~Blog/node_modules/hexo-theme-volantis/_config.yml</code>为<code>~/Blog/_config.volantis.yml</code> 然后修改<code>_config.volantis.yml</code> </p>
<p>终点关注<code>background</code>,<code>logo</code> ,<code>title</code>,<code>subtitle</code>,<code>search</code> <code>features</code></p>
<p>它们分别是</p>
<p><img src="https://s2.loli.net/2021/12/12/y8kld3rGNPM9aeS.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/12/y8kld3rGNPM9aeS.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211212193402005"></p>
<p>其中icon的图标是font awesome 系列的, 可以到<a href="http://www.fontawesome.com.cn/faicons/">这里</a>查对应icon的id.</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">cover:</span></span><br><span class="line">  <span class="attr">height_scheme:</span> <span class="string">full</span> <span class="comment"># full, half</span></span><br><span class="line">  <span class="attr">layout_scheme:</span> <span class="string">search</span> <span class="comment"># blank (留白), search (搜索), dock (坞), featured (精选), focus (焦点)</span></span><br><span class="line">  <span class="attr">display:</span></span><br><span class="line">    <span class="attr">home:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">archive:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">others:</span> <span class="literal">false</span> <span class="comment"># can be written in front-matter &#x27;cover: true&#x27;</span></span><br><span class="line">  <span class="attr">background:</span> <span class="string">https://s2.loli.net/2021/12/11/P8osRanT5FrtHuC.jpg</span> <span class="comment">#https://s2.loli.net/2021/12/10/2iCOIJd1R3uXmfN.jpg</span></span><br><span class="line">  <span class="attr">logo:</span> <span class="string">https://s2.loli.net/2021/12/10/qpIiAZe9lFWT75H.png</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">&#x27;Au1ong&#x27;</span></span><br><span class="line">  <span class="attr">subtitle:</span> <span class="string">&#x27;「Keep moving.Stay happy!」&#x27;</span></span><br><span class="line">  <span class="attr">search:</span> <span class="string">&#x27; 你是故意找岔儿是不是😅&#x27;</span> <span class="comment"># search bar placeholder</span></span><br><span class="line">  <span class="attr">features:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">文档</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-archive</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">archives/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">关于</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-info-circle</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">about/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">github</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">fab</span> <span class="string">fa-github</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">https://github.com/OuyangJunyuan</span></span><br></pre></td></tr></table></figure>

</div><h2 id="侧栏个人介绍"><a href="#侧栏个人介绍" class="headerlink" title="侧栏个人介绍"></a>侧栏个人介绍</h2><div class="story post-story"><p>同样是<code>~/Blog/_config.volantis.yml</code>,需改的地方是sidebar:widget_library:blogger. 如果侧边栏想加入新的东西,可以在<code>widget_library</code> 中添加组件.然后将组件填到<code>for_page</code> 和<code>for_post</code> 列表中,分别对应了主页侧栏和文章侧栏.</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">sidebar:</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">right</span> <span class="comment"># left right</span></span><br><span class="line">  <span class="comment"># 主页、分类、归档等独立页面</span></span><br><span class="line">  <span class="attr">for_page:</span> [<span class="string">blogger</span>,<span class="string">github</span>,<span class="string">category</span>,<span class="string">tagcloud</span>,<span class="string">webinfo</span>] <span class="comment"># 在页面中显示  ，中文逗号会使得后续内容失效</span></span><br><span class="line">  <span class="comment"># layout: docs/post 这类文章页面</span></span><br><span class="line">  <span class="attr">for_post:</span> [<span class="string">toc</span>] <span class="comment"># 在文章中显示</span></span><br><span class="line">  <span class="comment"># 侧边栏组件库</span></span><br><span class="line">  <span class="attr">widget_library:</span></span><br><span class="line">    <span class="comment"># ---------------------------------------</span></span><br><span class="line">    <span class="comment"># blogger info widget</span></span><br><span class="line">    <span class="attr">blogger:</span></span><br><span class="line">      <span class="attr">class:</span> <span class="string">blogger</span></span><br><span class="line">      <span class="attr">display:</span> [<span class="string">desktop</span>, <span class="string">mobile</span>] <span class="comment"># [desktop, mobile]  桌面端和手机端都可以看到</span></span><br><span class="line">      <span class="attr">avatar:</span> <span class="string">https://s2.loli.net/2021/12/11/A8vVRJM2CdfHOyL.png</span></span><br><span class="line">      <span class="attr">shape:</span> <span class="string">circle</span> <span class="comment"># circle, rectangle</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">/about/</span></span><br><span class="line">      <span class="attr">title:</span> <span class="string">&#x27;Auiong Tsunguan&#x27;</span></span><br><span class="line">      <span class="attr">subtitle:</span> <span class="string">&#x27; 躺平平 &amp; 敲代码 &#x27;</span></span><br><span class="line">      <span class="attr">jinrishici:</span> <span class="literal">false</span> <span class="comment"># Poetry Today. You can set a string, and it will be displayed when loading fails.</span></span><br><span class="line">      <span class="attr">social:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">icon:</span> <span class="string">fab</span> <span class="string">fa-github</span></span><br><span class="line">          <span class="attr">url:</span> <span class="string">https://github.com/OuyangJunyuan/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">img:</span> <span class="string">https://s2.loli.net/2021/12/11/91ROkjpEMHvP8he.png</span></span><br><span class="line">          <span class="attr">url:</span> <span class="string">https://www.zhihu.com/people/ou-yang-jun-yuan/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">icon:</span> <span class="string">fab</span> <span class="string">fa-qq</span></span><br><span class="line">          <span class="attr">url:</span>  <span class="string">mailto:706545330</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-envelope</span></span><br><span class="line">          <span class="attr">url:</span> <span class="string">mailto:706545330@qq.com</span></span><br><span class="line">         </span><br><span class="line"> <span class="string">...</span></span><br></pre></td></tr></table></figure>



</div><h2 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h2><div class="story post-story"><p>由于<a href="https://volantis.js.org/v5/getting-started/">官方文档</a>写的很清楚了,我就不再意义转发.</p>
<p>其中的标签是主题对markdown的拓展.</p>
<p><img src="https://s2.loli.net/2021/12/12/7yt6z3JMwcIYheX.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/12/7yt6z3JMwcIYheX.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211212194022018"></p>
<p>可以显示一些更漂亮东西.</p>
<p><img src="https://s2.loli.net/2021/12/12/ADJ9bFlwghT3W4G.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/12/ADJ9bFlwghT3W4G.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211212194138352"></p>
<p><img src="https://s2.loli.net/2021/12/12/AOyP1lxq369opds.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/12/AOyP1lxq369opds.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211212194144406"></p>

</div>]]></content>
      <categories>
        <category>教程</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>教程</tag>
        <tag>杂项</tag>
      </tags>
  </entry>
  <entry>
    <title>Learn Hexo</title>
    <url>/2021/12/10/Learn-Hexo/</url>
    <content><![CDATA[<p>这是摘要</p>
<div class="note"><p>info 摘要</p></div>

<span id="more"></span>



<p>这是正文</p>
<p>看这个文档<a href="https://volantis.js.org/v5/getting-started/">https://volantis.js.org/v5/getting-started/</a></p>
<p>$\alpha$<br>$$<br>\beta<br>$$</p>
<p>test markdown pic</p>
<p>🐑🐑</p>
<img src="https://s2.loli.net/2021/12/10/7dhPE4Cx2VDvl5B.jpg" class="lazyload" data-srcset="https://s2.loli.net/2021/12/10/7dhPE4Cx2VDvl5B.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="example pic" style="zoom:50%;" />

<p><img src="https://s2.loli.net/2021/12/10/2iCOIJd1R3uXmfN.jpg" class="lazyload" data-srcset="https://s2.loli.net/2021/12/10/2iCOIJd1R3uXmfN.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="mmexport1610430983424"></p>
<p><img src="https://s2.loli.net/2021/12/11/oYvq9uP4WgAdpB3.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/11/oYvq9uP4WgAdpB3.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="知乎 (1)"></p>
<p><img src="https://s2.loli.net/2021/12/11/91ROkjpEMHvP8he.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/11/91ROkjpEMHvP8he.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="知乎 (3)"></p>
<p><img src="https://s2.loli.net/2021/12/11/ahv15SOXT9EUJbV.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/11/ahv15SOXT9EUJbV.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="知乎 (2)"></p>
<p><img src="https://s2.loli.net/2021/12/10/r3lvL6i5Nde7GPZ.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/10/r3lvL6i5Nde7GPZ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="羊"></p>
<p><img src="https://s2.loli.net/2021/12/10/fRaB8yQDgshr7Y1.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/10/fRaB8yQDgshr7Y1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="小绵羊"></p>
<p><img src="https://s2.loli.net/2021/12/10/qpIiAZe9lFWT75H.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/10/qpIiAZe9lFWT75H.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="绵阳"></p>
<p><img src="https://s2.loli.net/2021/12/10/FwrM5uRDTkti126.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/10/FwrM5uRDTkti126.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="小绵羊"></p>
<p><img src="https://s2.loli.net/2021/12/10/L31xkctNjyGQVoZ.jpg" class="lazyload" data-srcset="https://s2.loli.net/2021/12/10/L31xkctNjyGQVoZ.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="wallhaven-9mg17w"></p>
<p><img src="https://s2.loli.net/2021/12/11/A8vVRJM2CdfHOyL.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/11/A8vVRJM2CdfHOyL.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="屏幕截图"></p>
<p><img src="/home/ou/.config/Typora/typora-user-images/image-20211211214543550.png" class="lazyload" data-srcset="/home/ou/.config/Typora/typora-user-images/image-20211211214543550.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211211214543550"></p>
<h1 id="卡通人物"><a href="#卡通人物" class="headerlink" title="卡通人物"></a>卡通人物</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save hexo-helper-live2d</span><br></pre></td></tr></table></figure>

<p>然后选一个 <a href="https://github.com/xiazeyu/live2d-widget-models">卡通人物</a> 安装对应包,推荐live2d-widget-model-shizuku,live2d-widget-model-koharu, live2d-widget-model-haruto.<a href="https://blog.csdn.net/wang_123_zy/article/details/87181892">预览</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install packagename</span><br></pre></td></tr></table></figure>



<h1 id="标签学习"><a href="#标签学习" class="headerlink" title="标签学习"></a>标签学习</h1><p><a href="https://volantis.js.org/v5/tag-plugins/">参考</a></p>
<p>可以认为标签是写markdown的一种拓展,可以渲染出更好看和更多的东西</p>
<div class="note info"><p>[note info]</p></div>

<p><img src="https://s2.loli.net/2021/12/11/7pnO8xdzWeijcfg.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/11/7pnO8xdzWeijcfg.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211211230924175"></p>
<p>这个gallery,也有用,用来展示多个图片</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery 参数" data-group='分组'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/B18FCBB3-67FD-48CC-B4F3-457BA145F17A.jpeg' data-fancybox='分组' data-caption='图片描述'><img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/B18FCBB3-67FD-48CC-B4F3-457BA145F17A.jpeg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/B18FCBB3-67FD-48CC-B4F3-457BA145F17A.jpeg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="图片描述"></a><span class='image-caption'>图片描述</span></div><br><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/67239FBB-E15D-4F4F-8EE8-0F1C9F3C4E7C.jpeg' data-fancybox='分组' data-caption='undefined'><img fancybox itemprop="contentUrl" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/67239FBB-E15D-4F4F-8EE8-0F1C9F3C4E7C.jpeg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/67239FBB-E15D-4F4F-8EE8-0F1C9F3C4E7C.jpeg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></a><span></span></div></div>


]]></content>
  </entry>
  <entry>
    <title>GLog使用记录</title>
    <url>/2021/12/12/GLog%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>​        GoogleLogging 的使用: 包括安装使用与功能配置.</p>
<span id="more"></span>



<h1 id="下载与安装"><a href="#下载与安装" class="headerlink" title="下载与安装"></a>下载与安装</h1><p>日志在工程中用来记录程序中间信息,是不可或缺的.我常用的有:</p>
<ul>
<li>log4cpp: 经典款</li>
<li><a href="https://github.com/PlatformLab/NanoLog">NanoLog</a>:现代款,速度恐怖</li>
<li><a href="https://github.com/google/glog">glog</a>: 经典款, 用的比较多.</li>
<li>如果在ros框架内,使用ROS自带的日志也能记录,可能就是功能欠缺了点.</li>
</ul>
<p>glog说不上有什么优点. 在不追求什么多线程异步日志,不追求极致性能的时候无脑用就完事. <a href="https://github.com/google/glog">github</a> 下载, 然后按cmake构建即可.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 注: 最近glog支持modern cmake 写法link上alias即可glog::glog</span></span><br><span class="line"><span class="keyword">find_package</span> (glog <span class="number">0.6</span>.<span class="number">0</span> REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span> (myapp main.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span> (myapp glog::glog)</span><br></pre></td></tr></table></figure>

<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="简单日志条目"><a href="#简单日志条目" class="headerlink" title="简单日志条目"></a>简单日志条目</h2><div class="story post-story"><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 包含 #include &lt;glog/logging.h&gt;</span></span><br><span class="line"><span class="built_in">TEST</span>(glog, simple_log) &#123;</span><br><span class="line">    <span class="built_in">LOG</span>(WARNING) &lt;&lt; <span class="string">&quot;WARNING\n&quot;</span>;</span><br><span class="line">    <span class="built_in">LOG</span>(INFO) &lt;&lt; <span class="string">&quot;INFO\n&quot;</span>;</span><br><span class="line">    <span class="built_in">LOG</span>(WARNING) &lt;&lt; <span class="string">&quot;WARNING\n&quot;</span>;</span><br><span class="line">    <span class="built_in">LOG</span>(ERROR) &lt;&lt; <span class="string">&quot;ERROR\n&quot;</span>;</span><br><span class="line">    <span class="built_in">LOG</span>(FATAL) &lt;&lt; <span class="string">&quot;FATAL\n&quot;</span>;   <span class="comment">// FATAL日志会终端程序并打印调用堆栈</span></span><br><span class="line">    <span class="built_in">VLOG</span>(<span class="number">0</span>) &lt;&lt; <span class="string">&quot;VLOG(0)\n&quot;</span>;   <span class="comment">// verbose logging, 级别为info, 可以认为是对info进行细粒度等级控制.</span></span><br><span class="line">&#125;</span><br><span class="line">--- 结果:</span><br><span class="line">WARNING: <span class="function">Logging before <span class="title">InitGoogleLogging</span><span class="params">()</span> is written to STDERR</span></span><br><span class="line"><span class="function">W20211212 15:<span class="number">39</span>:<span class="number">10.839241</span>  <span class="number">9219</span> main.cpp:<span class="number">6</span>] WARNING</span></span><br><span class="line"><span class="function">I20211212 <span class="number">15</span>:<span class="number">39</span>:<span class="number">10.839362</span>  <span class="number">9219</span> main.cpp:<span class="number">7</span>] INFO</span></span><br><span class="line"><span class="function">W20211212 <span class="number">15</span>:<span class="number">39</span>:<span class="number">10.839380</span>  <span class="number">9219</span> main.cpp:<span class="number">8</span>] WARNING</span></span><br><span class="line"><span class="function">E20211212 <span class="number">15</span>:<span class="number">39</span>:<span class="number">10.839396</span>  <span class="number">9219</span> main.cpp:<span class="number">9</span>] ERROR</span></span><br><span class="line"><span class="function">F20211212 <span class="number">15</span>:<span class="number">39</span>:<span class="number">10.839416</span>  <span class="number">9219</span> main.cpp:<span class="number">10</span>] FATAL</span></span><br><span class="line"><span class="function">*** Check failure stack trace: ***</span></span><br><span class="line"><span class="function">[<span class="number">1</span>]    <span class="number">9219</span> abort (core dumped)  ./test_glog</span></span><br></pre></td></tr></table></figure>

<p>如果ide有特殊支持(如clion)则可以有如下效果: 点击 蓝色文本 调转 到本行日志代码处.</p>
<p><img src="https://s2.loli.net/2021/12/12/Pk3zHLjOMXxAYS2.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/12/Pk3zHLjOMXxAYS2.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211212154112321"></p>
</div><h2 id="特殊日志条目"><a href="#特殊日志条目" class="headerlink" title="特殊日志条目"></a>特殊日志条目</h2><div class="story post-story"><p>glog也充分体会了大家的需求, 提供了一些特殊的LOG.下面结合需求介绍几个常用的</p>
<ul>
<li><p>LOG_EVERY_N: 当有一个以很高频率(1K)被执行的地方需要输出时, 使用此方法来避免打印满屏的信息使得其他信息被湮没.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2000</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">LOG_EVERY_N</span>(WARNING, <span class="number">1000</span>) &lt;&lt; <span class="string">&quot;LOG_EVERY_N&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>LOG_IF: 常用语当条件不满足时候发出警告.注:<code>LOG_ASSERT(cond) 等价于LOG_IF(FATAL, cond) </code>;</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">LOG_IF</span>(WARNING, when_cond_make_true)&lt;&lt; <span class="string">&quot;LOG_IF\n&quot;</span>;</span><br><span class="line">用于替换<span class="keyword">if</span>(when_cond_make_true) &#123;<span class="built_in">LOG</span>(level)&lt;&lt;...;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>LOG_FIRST_N: 对前N次进行输出,一般没用到</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">LOG_FIRST_N</span>(WARNING, <span class="number">10</span>) &lt;&lt; <span class="string">&quot;LOG_FIRST_N\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="功能配置"><a href="#功能配置" class="headerlink" title="功能配置"></a>功能配置</h1><p>如果日志只是能打印在公屏上,那不叫日志(不如用libfmt).日志还需要能:<code>写入日志文件</code> / <code>按级筛选信息</code>/ …</p>
<p>glog使用自家gflags来进行参数配置, 可以从<code>代码</code>/<code>配置文件</code>/<code>环境变量</code> 中读取配置.具体使用看需求:smile:. 下面将介绍常用配置:</p>
</div><h2 id="必备"><a href="#必备" class="headerlink" title="必备"></a>必备</h2><div class="story post-story"><p>刚才的例子都是只在终端上显式,且提示<code>WARNING: Logging before InitGoogleLogging() is written to STDERR</code> 是因为并没有初始化. 下面对glog进行初始化来开启全功能</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">--- 能拿到进程入口参数时 </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    google::<span class="built_in">InitGoogleLogging</span>(argv[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line">--- 不能拿到进程入口参数时</span><br><span class="line"><span class="keyword">static</span> std::string params;</span><br><span class="line">google::<span class="built_in">InitGoogleLogging</span>(params.<span class="built_in">c_str</span>());</span><br></pre></td></tr></table></figure>



</div><h2 id="日志文件写入设置"><a href="#日志文件写入设置" class="headerlink" title="日志文件写入设置"></a>日志文件写入设置</h2><div class="story post-story"><p>默认开启文件写入(默认目录为根目录/tmp).</p>
<p> 注:<code>glog的输出到文件和输出到终端是可以分别控制的,配置不当可能没显式在终端却已经写入了文件, 此时会让人觉得程序没有执行到所期望的语句.</code></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">TEST</span>(glog, log_file) &#123;</span><br><span class="line">    <span class="function">std::string <span class="title">params</span><span class="params">(<span class="string">&quot;test_glog&quot;</span>)</span></span>;</span><br><span class="line">    google::<span class="built_in">InitGoogleLogging</span>(params.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief 设置INFO等级的日志目录和文件名</span></span><br><span class="line"><span class="comment">     * @attention 以下各种参数的不同</span></span><br><span class="line"><span class="comment">     * 0. 确保&quot;../info/&quot; 中info目录的存在,否则失败.</span></span><br><span class="line"><span class="comment">     * 1. &quot;../info/&quot;  输出到目录info下,没有指定生成的日志文件名,默认按时间命名为: ../info/20211212-163428.11990</span></span><br><span class="line"><span class="comment">     * 2. &quot;../info&quot;  少了末位的&#x27;/&#x27;, 被解释为: ../info20211212-164011.12224</span></span><br><span class="line"><span class="comment">     * 3. &quot;../info/base_name  被解释为: ../info/base_name20211212-164011.12224</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    google::<span class="built_in">SetLogDestination</span>(google::INFO, <span class="string">&quot;../info/base_name&quot;</span>);</span><br><span class="line">    <span class="comment">// 解释为: ../info/base_name.externtion20211212-164309.12362</span></span><br><span class="line">    FLAGS_timestamp_in_logfile_name = <span class="literal">false</span>;  <span class="comment">// 去掉文件名后的时间戳, 可以自己指定其他标志来区分.</span></span><br><span class="line">    std::string dir = <span class="string">&quot;../info&quot;</span>, base_name = <span class="string">&quot;base_name&quot;</span>, externtion = <span class="string">&quot;.externtion&quot;</span>;</span><br><span class="line">    std::string cmd=<span class="string">&quot;mkdir &quot;</span>+ dir;</span><br><span class="line">    <span class="built_in">system</span>(cmd.<span class="built_in">c_str</span>()); <span class="comment">//确保&quot;../info/&quot; 中info目录的存在,否则失败.</span></span><br><span class="line">    google::<span class="built_in">SetLogDestination</span>(google::INFO, (dir + <span class="string">&quot;/&quot;</span> + base_name).<span class="built_in">c_str</span>());</span><br><span class="line">    google::<span class="built_in">SetLogFilenameExtension</span>(externtion.<span class="built_in">c_str</span>()); <span class="comment">// 设置拓展名</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  @brief 为最近一次生成的日志文件在指定地点生成软链接</span></span><br><span class="line"><span class="comment">     *  如下例子解释为生成[INFO日志目录]和[FLAGS_log_link]下都生成[latest.INFO] 链接.</span></span><br><span class="line"><span class="comment">     *  @attention 是用来在快速查看最新INFO日志的方法,避免在INFO日志目录下手动寻找最新.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    FLAGS_log_link = dir + <span class="string">&quot;/../&quot;</span>; <span class="comment">// 必须为绝对路径,否则建立失败</span></span><br><span class="line">    std::string log_symlink = <span class="string">&quot;latest&quot;</span>;</span><br><span class="line">    google::<span class="built_in">SetLogSymlink</span>(google::INFO, log_symlink.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">LOG</span>(INFO) &lt;&lt; <span class="string">&quot;INFO\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>此外设置<code>FLAGS_log_prefix = false;</code> 可以使得日志不带前缀.</p>
<p><code>I20211212 17:25:28.392503 15469 main.cpp:37] INFO                 =&gt;                 INFO</code></p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>在项目中我按 <code>进程/每天1个文件夹/等级</code>来安排日志,并在外层放置最新一次日志的链接方便查看.</p>
<p><img src="https://s2.loli.net/2021/12/12/wDQl6GXagH3eNKy.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/12/wDQl6GXagH3eNKy.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211212184837708"></p>
</div><h2 id="终端-stderr-显式"><a href="#终端-stderr-显式" class="headerlink" title="终端(stderr)显式"></a>终端(stderr)显式</h2><div class="story post-story"><p>注:<code>stderr没有缓存,会直接打印到终端并显式红色.因此可能其和stdout的执行顺序会颠倒.</code></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">TEST</span>(glog, log_stderr) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//FLAGS_logtostderr=true;  // 打开注释则不输出到日志文件,只输出到stderr</span></span><br><span class="line">    <span class="built_in">fprintf</span>(stderr,<span class="string">&quot;before FLAGS_stderrthreshold=0\n&quot;</span>);</span><br><span class="line">    <span class="built_in">LOG</span>(INFO) &lt;&lt; <span class="string">&quot;INFO\n&quot;</span>;       <span class="comment">// 未设置FLAGS_stderrthreshold(默认error), 因此此条不输出到终端,但可以输出到日志</span></span><br><span class="line">    <span class="built_in">LOG</span>(WARNING) &lt;&lt; <span class="string">&quot;WARNING\n&quot;</span>;  <span class="comment">// 未设置FLAGS_stderrthreshold(默认为error) 因此此条不输出到终端,但可以输出到日志</span></span><br><span class="line">    <span class="built_in">LOG</span>(ERROR) &lt;&lt; <span class="string">&quot;ERROR\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置输出到stderr的日志级别限制 大于等于此值级别的日志才能显式在终端.取值[0, 4].</span></span><br><span class="line">    FLAGS_stderrthreshold = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(stderr,<span class="string">&quot;after FLAGS_stderrthreshold=0\n&quot;</span>);</span><br><span class="line">    <span class="built_in">LOG</span>(INFO) &lt;&lt; <span class="string">&quot;INFO\n&quot;</span>;</span><br><span class="line">    <span class="built_in">LOG</span>(WARNING) &lt;&lt; <span class="string">&quot;WARNING\n&quot;</span>;</span><br><span class="line">    <span class="built_in">LOG</span>(ERROR) &lt;&lt; <span class="string">&quot;ERROR\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置彩色stderr</span></span><br><span class="line">    FLAGS_colorlogtostderr = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">fprintf</span>(stderr,<span class="string">&quot;after FLAGS_colorlogtostderr=true\n&quot;</span>);</span><br><span class="line">    <span class="built_in">LOG</span>(INFO) &lt;&lt; <span class="string">&quot;INFO\n&quot;</span>;</span><br><span class="line">    <span class="built_in">LOG</span>(WARNING) &lt;&lt; <span class="string">&quot;WARNING\n&quot;</span>;</span><br><span class="line">    <span class="built_in">LOG</span>(ERROR) &lt;&lt; <span class="string">&quot;ERROR\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="https://s2.loli.net/2021/12/12/JwGIRSvqVaQcZC7.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/12/JwGIRSvqVaQcZC7.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211212170845497"></p>
</div><h2 id="等级过滤"><a href="#等级过滤" class="headerlink" title="等级过滤"></a>等级过滤</h2><div class="story post-story"><p>能设置等级的一个有3个变量下面一一介绍:  </p>
<ul>
<li><p>FLAGS_v: 设置VLOG等级,VLOG是INFO级别的. 但是对INFO内又划分了级别,可以进行细粒度控制(因为INFO级别用的最多)</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">TEST</span>(glog, filter) &#123;</span><br><span class="line"><span class="comment">//    FLAGS_stderrthreshold = 0;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">VLOG</span>(<span class="number">0</span>) &lt;&lt;<span class="string">&quot;VLOG(0)\n&quot;</span>;</span><br><span class="line">    <span class="built_in">VLOG</span>(<span class="number">1</span>) &lt;&lt;<span class="string">&quot;VLOG(1)\n&quot;</span>;</span><br><span class="line">    <span class="built_in">VLOG</span>(<span class="number">2</span>) &lt;&lt;<span class="string">&quot;VLOG(2)\n&quot;</span>;</span><br><span class="line">    <span class="built_in">VLOG</span>(<span class="number">3</span>) &lt;&lt;<span class="string">&quot;VLOG(3)\n&quot;</span>;</span><br><span class="line">    <span class="built_in">VLOG</span>(<span class="number">4</span>) &lt;&lt;<span class="string">&quot;VLOG(4)\n&quot;</span>;</span><br><span class="line">    <span class="built_in">VLOG</span>(<span class="number">5</span>) &lt;&lt;<span class="string">&quot;VLOG(5)\n&quot;</span>;</span><br><span class="line">    FLAGS_v = <span class="number">2</span>;   <span class="comment">// 只记录 VLOG级别不大于此值的VLOG.</span></span><br><span class="line">    <span class="built_in">VLOG</span>(<span class="number">0</span>) &lt;&lt;<span class="string">&quot;VLOG(0)\n&quot;</span>;</span><br><span class="line">    <span class="built_in">VLOG</span>(<span class="number">1</span>) &lt;&lt;<span class="string">&quot;VLOG(1)\n&quot;</span>;</span><br><span class="line">    <span class="built_in">VLOG</span>(<span class="number">2</span>) &lt;&lt;<span class="string">&quot;VLOG(2)\n&quot;</span>;</span><br><span class="line">    <span class="built_in">VLOG</span>(<span class="number">3</span>) &lt;&lt;<span class="string">&quot;VLOG(3)\n&quot;</span>;</span><br><span class="line">    <span class="built_in">VLOG</span>(<span class="number">4</span>) &lt;&lt;<span class="string">&quot;VLOG(4)\n&quot;</span>;</span><br><span class="line">    <span class="built_in">VLOG</span>(<span class="number">5</span>) &lt;&lt;<span class="string">&quot;VLOG(5)\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现象是, 终端无输出(因为没设置FLAGS_stderrthreshold为0,默认只有error级别以上才输出),而日志文件有输出.</p>
<p><img src="https://s2.loli.net/2021/12/12/5NhkueMKvaDZ7wX.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/12/5NhkueMKvaDZ7wX.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211212172742578"></p>
<p>此外,还可以对不同源文件指定不同的VLOG级别<code> google::SetVLOGLevel</code>,上述<code>FLAGS_v=2</code>可以替换为<code>    google::SetVLOGLevel(&quot;main&quot;,2);</code> 现象一致..</p>
</li>
<li><p>FLAGS_stderrthreshold: 上面说过的,设置输出到stderr的级别限制.</p>
</li>
<li><p>FLAGS_minloglevel: 同时限制日志和stderror最低输出等级.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">TEST</span>(glog, filter) &#123;</span><br><span class="line">    FLAGS_stderrthreshold = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;after FLAGS_stderrthreshold=0\n&quot;</span>);</span><br><span class="line">    <span class="built_in">LOG</span>(INFO) &lt;&lt; <span class="string">&quot;INFO\n&quot;</span>;</span><br><span class="line">    <span class="built_in">LOG</span>(WARNING) &lt;&lt; <span class="string">&quot;WARNING\n&quot;</span>;</span><br><span class="line">    <span class="built_in">LOG</span>(ERROR) &lt;&lt; <span class="string">&quot;ERROR\n&quot;</span>;</span><br><span class="line">    FLAGS_minloglevel = <span class="number">2</span>; <span class="comment">// 0:INFO 1: WARNING 2:ERROR 3:FATAL</span></span><br><span class="line">    <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;after FLAGS_minloglevel=2\n&quot;</span>);</span><br><span class="line">    <span class="built_in">LOG</span>(INFO) &lt;&lt; <span class="string">&quot;INFO\n&quot;</span>;</span><br><span class="line">    <span class="built_in">LOG</span>(WARNING) &lt;&lt; <span class="string">&quot;WARNING\n&quot;</span>;</span><br><span class="line">    <span class="built_in">LOG</span>(ERROR) &lt;&lt; <span class="string">&quot;ERROR\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2021/12/12/zRf9WNCiEJ8DK2U.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/12/zRf9WNCiEJ8DK2U.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211212172140972"></p>
</li>
</ul>
<p>注:这几个FLAGS之间有覆盖关系. </p>
</div><h2 id="日志大小"><a href="#日志大小" class="headerlink" title="日志大小"></a>日志大小</h2><div class="story post-story"><p>此外还提供日志大小的限制, 当硬盘空间不足时停止写入或者当日志大小超过一定大小(MB)后停止写入.</p>
<p>详见:FLAGS_max_log_size和FLAGS_stop_logging_if_full_disk</p>
</div><h2 id="信号捕捉与遗言"><a href="#信号捕捉与遗言" class="headerlink" title="信号捕捉与遗言"></a>信号捕捉与遗言</h2><div class="story post-story"><p>glog对常见的进程失败信号进行处理,如常见的SIGABRT/SIGSEGV等.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">TEST</span>(glog, sig) &#123;</span><br><span class="line">    google::<span class="built_in">InstallFailureSignalHandler</span>();</span><br><span class="line">    <span class="keyword">int</span> array[<span class="number">1</span>];</span><br><span class="line">    array[<span class="number">2</span>] = <span class="number">0</span>; <span class="comment">// overflow</span></span><br><span class="line">&#125;</span><br><span class="line">--- 输出到终端如下</span><br><span class="line">*** stack smashing detected ***: &lt;unknown&gt; terminated</span><br><span class="line">*** Aborted at <span class="number">1639302205</span> (unix time) <span class="keyword">try</span> <span class="string">&quot;date -d @1639302205&quot;</span> <span class="keyword">if</span> you are <span class="keyword">using</span> GNU date ***</span><br><span class="line">PC: @                <span class="number">0x0</span> (unknown)</span><br><span class="line">*** <span class="built_in">SIGABRT</span> (@<span class="number">0x3e800003f7b</span>) received by PID <span class="number">16251</span> (TID <span class="number">0x7fc5925c9e80</span>) from PID <span class="number">16251</span>; stack trace: ***</span><br><span class="line">    @     <span class="number">0x7fc591fc9980</span> (unknown)</span><br><span class="line">    @     <span class="number">0x7fc5912c5fb7</span> gsignal</span><br><span class="line">    @     <span class="number">0x7fc5912c7921</span> abort</span><br><span class="line">    @     <span class="number">0x7fc591310967</span> (unknown)</span><br><span class="line">    @     <span class="number">0x7fc5913bbb61</span> (unknown)</span><br><span class="line">    @     <span class="number">0x7fc5913bbb22</span> __stack_chk_fail</span><br><span class="line">    @     <span class="number">0x55a985bd43a0</span> glog_sig_Test::<span class="built_in">TestBody</span>()</span><br><span class="line">    @     <span class="number">0x55a985c24bbf</span> testing::internal::HandleSehExceptionsInMethodIfSupported&lt;&gt;()</span><br><span class="line">    @     <span class="number">0x55a985c1dbdd</span> testing::internal::HandleExceptionsInMethodIfSupported&lt;&gt;()</span><br><span class="line">    @     <span class="number">0x55a985bf47ca</span> testing::Test::<span class="built_in">Run</span>()</span><br><span class="line">    @     <span class="number">0x55a985bf5198</span> testing::TestInfo::<span class="built_in">Run</span>()</span><br><span class="line">    @     <span class="number">0x55a985bf5a76</span> testing::TestSuite::<span class="built_in">Run</span>()</span><br><span class="line">    @     <span class="number">0x55a985c04c04</span> testing::internal::UnitTestImpl::<span class="built_in">RunAllTests</span>()</span><br><span class="line">    @     <span class="number">0x55a985c25ded</span> testing::internal::HandleSehExceptionsInMethodIfSupported&lt;&gt;()</span><br><span class="line">    @     <span class="number">0x55a985c1eb97</span> testing::internal::HandleExceptionsInMethodIfSupported&lt;&gt;()</span><br><span class="line">    @     <span class="number">0x55a985c0340e</span> testing::UnitTest::<span class="built_in">Run</span>()</span><br><span class="line">    @     <span class="number">0x55a985c36530</span> <span class="built_in">RUN_ALL_TESTS</span>()</span><br><span class="line">    @     <span class="number">0x55a985c364bf</span> main</span><br><span class="line">    @     <span class="number">0x7fc5912a8bf7</span> __libc_start_main</span><br><span class="line">    @     <span class="number">0x55a985bd3a3a</span> _start</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">134</span> (interrupted by signal <span class="number">6</span>: SIGABRT)</span><br></pre></td></tr></table></figure>

<p>上述只是显式在终端, 如果想将上面的文本加入到日志文件则:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">FailureToLog</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *data, <span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> msg[size + <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">memcpy</span>(msg, data, size);</span><br><span class="line">    msg[size - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    msg[size] = <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="built_in">LOG</span>(ERROR) &lt;&lt; msg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>则将日志打印到ERROR中.</p>
<h1 id="功能添加"><a href="#功能添加" class="headerlink" title="功能添加"></a>功能添加</h1></div><h2 id="小工具"><a href="#小工具" class="headerlink" title="小工具"></a>小工具</h2><div class="story post-story"><p>配合fmt变量打印</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fmt/format.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fmt/ranges.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/preprocessor.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BOOST_PP_SEQ_FOR_EACH_LOGDEBUG_STR_MACRO(i, ctx, elem) \</span></span><br><span class="line"><span class="meta">                                                            BOOST_PP_STRINGIZE(elem) <span class="meta-string">&quot; = &#123;&#125;. &quot;</span>                          \</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BOOST_PP_SEQ_FOR_EACH_LOGDEBUG_STR(seq)             BOOST_PP_SEQ_FOR_EACH(                                      \</span></span><br><span class="line"><span class="meta">                                                                BOOST_PP_SEQ_FOR_EACH_LOGDEBUG_STR_MACRO,               \</span></span><br><span class="line"><span class="meta">                                                                BOOST_PP_SEQ_SIZE(seq),seq)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BOOST_PP_SEQ_FOR_EACH_LOGDEBUG_ARGS(seq)            BOOST_PP_SEQ_ENUM(seq)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VLOGF(LEVEL, MODULE, ...)                           VLOG(LEVEL) &lt;&lt;fmt::format(<span class="meta-string">&quot;[&quot;</span> #MODULE <span class="meta-string">&quot;] &quot;</span>)                 \</span></span><br><span class="line"><span class="meta">                                                                        &lt;&lt; fmt::format(__VA_ARGS__)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGF(LEVEL, MODULE, ...)                            LOG(LEVEL)  &lt;&lt;fmt::format(<span class="meta-string">&quot;[&quot;</span> #MODULE <span class="meta-string">&quot;] &quot;</span>)                 \</span></span><br><span class="line"><span class="meta">                                                                        &lt;&lt; fmt::format(__VA_ARGS__)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VLOG_DEBUG(LEVEL, MODULE, SEQ)                      VLOGF(LEVEL,MODULE,BOOST_PP_SEQ_FOR_EACH_LOGDEBUG_STR(SEQ), \</span></span><br><span class="line"><span class="meta">                                                                              BOOST_PP_SEQ_FOR_EACH_LOGDEBUG_ARGS(SEQ)) \</span></span><br><span class="line"><span class="meta">                                                                              &lt;&lt; fmt::format(<span class="meta-string">&quot;\n&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOG_DEBUG(LEVEL, MODULE, SEQ)                       LOGF(LEVEL,MODULE,BOOST_PP_SEQ_FOR_EACH_LOGDEBUG_STR(SEQ),  \</span></span><br><span class="line"><span class="meta">                                                                              BOOST_PP_SEQ_FOR_EACH_LOGDEBUG_ARGS(SEQ)) \</span></span><br><span class="line"><span class="meta">                                                                              &lt;&lt; fmt::format(<span class="meta-string">&quot;\n&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">TEST</span>(glog, utils) &#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>, b;</span><br><span class="line">    std::vector&lt;<span class="keyword">int</span>&gt; c&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    <span class="built_in">LOG_DEBUG</span>(ERROR, glog_utils_test, (a)(b)(c));</span><br><span class="line">&#125;</span><br><span class="line">---</span><br><span class="line">E20211212 <span class="number">17</span>:<span class="number">55</span>:<span class="number">57.852751</span> <span class="number">17268</span> main.cpp:<span class="number">93</span>] [glog_utils_test] a = <span class="number">0.</span> b = <span class="number">21968.</span> c = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]. </span><br></pre></td></tr></table></figure>

</div><h2 id="使能功能"><a href="#使能功能" class="headerlink" title="使能功能"></a>使能功能</h2><div class="story post-story"><p>想使得glog使能和失能很简单.把等级阈值都设置最高即可.</p>
<p>也可以在glogging.cc内添加</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">GLOG_DEFINE_bool</span>(enable,</span><br><span class="line">                 <span class="built_in">BoolFromEnv</span>(<span class="string">&quot;GOOGLE_ENABLE&quot;</span>, <span class="literal">false</span>),</span><br><span class="line">                 <span class="string">&quot;enable glog&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>然后在<code>void LogMessage::SendToLog() EXCLUSIVE_LOCKS_REQUIRED(log_mutex)</code>对<code>if (FLAGS_logtostderr || !IsGoogleLoggingInitialized())</code> 的两个情况进行修改. </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (FLAGS_logtostderr || !<span class="built_in">IsGoogleLoggingInitialized</span>()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (FLAGS_enable) &#123;</span><br><span class="line">        <span class="built_in">ColoredWriteToStderr</span>(data_-&gt;severity_,</span><br><span class="line">                             data_-&gt;message_text_, data_-&gt;num_chars_to_log_);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// this could be protected by a flag if necessary.</span></span><br><span class="line">    LogDestination::<span class="built_in">LogToSinks</span>(data_-&gt;severity_,</span><br><span class="line">                               data_-&gt;fullname_, data_-&gt;basename_,</span><br><span class="line">                               data_-&gt;line_, &amp;data_-&gt;tm_time_,</span><br><span class="line">                               data_-&gt;message_text_ + data_-&gt;num_prefix_chars_,</span><br><span class="line">                               (data_-&gt;num_chars_to_log_ -</span><br><span class="line">                                data_-&gt;num_prefix_chars_ - <span class="number">1</span>),</span><br><span class="line">                               data_-&gt;usecs_);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (FLAGS_enable) &#123;</span><br><span class="line">        <span class="comment">// log this message to all log files of severity &lt;= severity_</span></span><br><span class="line">        LogDestination::<span class="built_in">LogToAllLogfiles</span>(data_-&gt;severity_, data_-&gt;timestamp_,</span><br><span class="line">                                         data_-&gt;message_text_,</span><br><span class="line">                                         data_-&gt;num_chars_to_log_);</span><br><span class="line"></span><br><span class="line">        LogDestination::<span class="built_in">MaybeLogToStderr</span>(data_-&gt;severity_, data_-&gt;message_text_,</span><br><span class="line">                                         data_-&gt;num_chars_to_log_,</span><br><span class="line">                                         data_-&gt;num_prefix_chars_);</span><br><span class="line">        LogDestination::<span class="built_in">MaybeLogToEmail</span>(data_-&gt;severity_, data_-&gt;message_text_,</span><br><span class="line">                                        data_-&gt;num_chars_to_log_);</span><br><span class="line">    &#125;</span><br><span class="line">    LogDestination::<span class="built_in">LogToSinks</span>(data_-&gt;severity_,</span><br><span class="line">                               data_-&gt;fullname_, data_-&gt;basename_,</span><br><span class="line">                               data_-&gt;line_, &amp;data_-&gt;tm_time_,</span><br><span class="line">                               data_-&gt;message_text_ + data_-&gt;num_prefix_chars_,</span><br><span class="line">                               (data_-&gt;num_chars_to_log_</span><br><span class="line">                                - data_-&gt;num_prefix_chars_ - <span class="number">1</span>),</span><br><span class="line">                               data_-&gt;usecs_);</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> -1 removes trailing \n</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后就可以快乐的和前面一样使用<code>FLAGS_enable</code>进行开关了(记得声明一下对应的flag)</p>
</div><h2 id="颜色修改"><a href="#颜色修改" class="headerlink" title="颜色修改"></a>颜色修改</h2><div class="story post-story"><p>修改glogging.cc内<code>static GLogColor SeverityToColor(LogSeverity severity)</code> 这个函数和<code>enum GLogColor</code> 对应的tags.以及修改每个tag对应的颜色.这些颜色都是ansi code, 可以查询对应的.或加入高亮,下划线,闪烁等功能都是可以的.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> *<span class="title">GetAnsiColorCode</span><span class="params">(GLogColor color)</span> </span>&#123;</span><br><span class="line">    <span class="built_in"><span class="keyword">switch</span></span> (color) &#123;</span><br><span class="line">        <span class="keyword">case</span> COLOR_BLACK:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> COLOR_RED:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> COLOR_GREEN:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;2&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> COLOR_YELLOW:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;3&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> COLOR_BLUE:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;4&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> COLOR_PURPLE:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;5&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> COLOR_DARK_GREEN:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;6&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> COLOR_WHITE:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;7&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> COLOR_DEFAULT:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>; <span class="comment">// stop warning about return type.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="源码与运行流程分析"><a href="#源码与运行流程分析" class="headerlink" title="源码与运行流程分析"></a>源码与运行流程分析</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LOG(INFO) &lt;&lt;&quot;123\n&quot;;</span><br><span class="line">=&gt; </span><br><span class="line">COMPACT_GOOGLE_LOG_INFO.stream() &lt;&lt;&quot;123\n&quot;;</span><br><span class="line">=&gt;</span><br><span class="line">google::LogMessage(__FILE__, __LINE__).stream() &lt;&lt;&quot;123\n&quot;; </span><br><span class="line">其中stream()返回LogStream(继承于ostream)并将buffer设置为手动管理的.</span><br><span class="line">=&gt;</span><br><span class="line">调用send_method_ = SendToLog 函数</span><br><span class="line">=&gt; </span><br><span class="line">判断是否初始化.进行提示</span><br><span class="line">判断是否需要输出到日志或终端stderr</span><br><span class="line">判断是否FATAL退出程序和扫尾工作</span><br><span class="line">=&gt;</span><br><span class="line">LogToAllLogfiles  =&gt; MaybeLogToLogfile把每个级别的日志写入对应文件中.</span><br><span class="line">MaybeLogToStderr =&gt; 输出到终端stderr</span><br><span class="line">ColoredWriteToStderr ...</span><br><span class="line">MaybeLogToEmail ...</span><br></pre></td></tr></table></figure>






</div>]]></content>
      <categories>
        <category>教程</category>
        <category>库</category>
      </categories>
      <tags>
        <tag>教程</tag>
        <tag>C++</tag>
        <tag>库</tag>
      </tags>
  </entry>
</search>
